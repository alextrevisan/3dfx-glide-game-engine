#include <glide.h>
#include <glide3x_dll.h>

decltype(grAADrawTriangle) grAADrawTriangle;
decltype(grAlphaBlendFunction) grAlphaBlendFunction = nullptr;
decltype(grAlphaCombine) grAlphaCombine = nullptr;
decltype(grAlphaControlsITRGBLighting) grAlphaControlsITRGBLighting = nullptr;
decltype(grAlphaTestFunction) grAlphaTestFunction = nullptr;
decltype(grAlphaTestReferenceValue) grAlphaTestReferenceValue = nullptr;
decltype(grBufferClear) grBufferClear = nullptr;
decltype(grBufferSwap) grBufferSwap = nullptr;
//grCheckForRoom = (decltype(grCheckForRoom)) GetProcAddress(glide3xDllHandle, "_grCheckForRoom@4");
decltype(grChromakeyMode) grChromakeyMode = nullptr;
decltype(grChromakeyValue) grChromakeyValue = nullptr;
decltype(grClipWindow) grClipWindow = nullptr;
decltype(grColorCombine) grColorCombine = nullptr;
decltype(grColorMask) grColorMask = nullptr;
decltype(grConstantColorValue) grConstantColorValue = nullptr;
decltype(grCoordinateSpace) grCoordinateSpace = nullptr;
decltype(grCullMode) grCullMode = nullptr;
decltype(grDepthBiasLevel) grDepthBiasLevel = nullptr;
decltype(grDepthBufferFunction) grDepthBufferFunction = nullptr;
decltype(grDepthBufferMode) grDepthBufferMode = nullptr;
decltype(grDepthMask) grDepthMask = nullptr;
decltype(grDepthRange) grDepthRange = nullptr;
decltype(grDisable) grDisable = nullptr;
decltype(grDisableAllEffects) grDisableAllEffects = nullptr;
decltype(grDitherMode) grDitherMode = nullptr;
decltype(grDrawLine) grDrawLine = nullptr;
decltype(grDrawPoint) grDrawPoint = nullptr;
decltype(grDrawTriangle) grDrawTriangle = nullptr;
decltype(grDrawVertexArray) grDrawVertexArray = nullptr;
decltype(grDrawVertexArrayContiguous) grDrawVertexArrayContiguous = nullptr;
decltype(grEnable) grEnable = nullptr;
decltype(grErrorSetCallback) grErrorSetCallback = nullptr;
decltype(grFinish) grFinish = nullptr;
decltype(grFlush) grFlush = nullptr;
decltype(grFogColorValue) grFogColorValue = nullptr;
decltype(grFogMode) grFogMode = nullptr;
decltype(grFogTable) grFogTable = nullptr;
decltype(grGet) grGet = nullptr;
decltype(grGetProcAddress) grGetProcAddress = nullptr;
decltype(grGetString) grGetString = nullptr;
decltype(grGlideGetState) grGlideGetState = nullptr;
decltype(grGlideGetVertexLayout) grGlideGetVertexLayout = nullptr;
decltype(grGlideInit) grGlideInit = nullptr;
decltype(grGlideSetState) grGlideSetState = nullptr;
decltype(grGlideSetVertexLayout) grGlideSetVertexLayout = nullptr;
decltype(grGlideShutdown) grGlideShutdown = nullptr;
decltype(grLfbConstantAlpha) grLfbConstantAlpha = nullptr;
decltype(grLfbConstantDepth) grLfbConstantDepth = nullptr;
decltype(grLfbLock) grLfbLock = nullptr;
decltype(grLfbReadRegion) grLfbReadRegion = nullptr;
decltype(grLfbUnlock) grLfbUnlock = nullptr;
decltype(grLfbWriteColorFormat) grLfbWriteColorFormat = nullptr;
decltype(grLfbWriteColorSwizzle) grLfbWriteColorSwizzle = nullptr;
decltype(grLfbWriteRegion) grLfbWriteRegion = nullptr;
decltype(grLoadGammaTable) grLoadGammaTable = nullptr;
decltype(grQueryResolutions) grQueryResolutions = nullptr;
decltype(grRenderBuffer) grRenderBuffer = nullptr;
decltype(grReset) grReset = nullptr;
decltype(grSelectContext) grSelectContext = nullptr;
decltype(grSetNumPendingBuffers) grSetNumPendingBuffers = nullptr;
decltype(grSplash) grSplash = nullptr;
//grSstConfigPipeline = (decltype(grSstConfigPipeline)) GetProcAddress(glide3xDllHandle, "_grSstConfigPipeline@12");
decltype(grSstOrigin) grSstOrigin = nullptr;
decltype(grSstSelect) grSstSelect = nullptr;
//grSstVidMode = (decltype(grSstVidMode)) GetProcAddress(glide3xDllHandle, "_grSstVidMode@8");
decltype(grSstWinClose) grSstWinClose = nullptr;
decltype(grSstWinOpen) grSstWinOpen = nullptr;
decltype(grStippleMode) grStippleMode = nullptr;
decltype(grStipplePattern) grStipplePattern = nullptr;
decltype(grTexCalcMemRequired) grTexCalcMemRequired = nullptr;
decltype(grTexClampMode) grTexClampMode = nullptr;
decltype(grTexCombine) grTexCombine = nullptr;
decltype(grTexDetailControl) grTexDetailControl = nullptr;
decltype(grTexDownloadMipMap) grTexDownloadMipMap = nullptr;
decltype(grTexDownloadMipMapLevel) grTexDownloadMipMapLevel = nullptr;
decltype(grTexDownloadMipMapLevelPartial) grTexDownloadMipMapLevelPartial = nullptr;
decltype(grTexDownloadTable) grTexDownloadTable = nullptr;
decltype(grTexDownloadTablePartial) grTexDownloadTablePartial = nullptr;
decltype(grTexFilterMode) grTexFilterMode = nullptr;
decltype(grTexLodBiasValue) grTexLodBiasValue = nullptr;
decltype(grTexMaxAddress) grTexMaxAddress = nullptr;
decltype(grTexMinAddress) grTexMinAddress = nullptr;
decltype(grTexMipMapMode) grTexMipMapMode = nullptr;
decltype(grTexMultibase) grTexMultibase = nullptr;
decltype(grTexMultibaseAddress) grTexMultibaseAddress = nullptr;
decltype(grTexNCCTable) grTexNCCTable = nullptr;
decltype(grTexSource) grTexSource = nullptr;
decltype(grTexTextureMemRequired) grTexTextureMemRequired = nullptr;
decltype(grVertexLayout) grVertexLayout = nullptr;
decltype(grViewport) grViewport = nullptr;
decltype(gu3dfGetInfo) gu3dfGetInfo = nullptr;
decltype(gu3dfLoad) gu3dfLoad = nullptr;
//guEncodeRLE16 = (decltype(guEncodeRLE16)) GetProcAddress(glide3xDllHandle, "_guEncodeRLE16@16");
decltype(guFogGenerateExp2) guFogGenerateExp2 = nullptr;
decltype(guFogGenerateExp) guFogGenerateExp = nullptr;
decltype(guFogGenerateLinear) guFogGenerateLinear = nullptr;
decltype(guFogTableIndexToW) guFogTableIndexToW = nullptr;
decltype(guGammaCorrectionRGB) guGammaCorrectionRGB = nullptr;
auto SafeGetProcAddress(HINSTANCE i, LPCSTR s)
{
    auto ptr = GetProcAddress(i, s);
    if(ptr == nullptr)
    {
        char data[256] = {'\0'};
        strcpy(data, s+1);
        ptr = GetProcAddress(i, data);
    }
    return ptr;
}
void init_glide3x_dll()
{
    HMODULE glide3xDllHandle = LoadLibrary("glide3x.dll");
    if(!glide3xDllHandle)
        throw std::runtime_error("No glide driver found!");
    //grAADrawTriangle = (decltype(grAADrawTriangle)) SafeGetProcAddress(glide3xDllHandle, "_grAADrawTriangle@24");
    grAADrawTriangle = (decltype(grAADrawTriangle)) SafeGetProcAddress(glide3xDllHandle, "_grAADrawTriangle@24");
    grAlphaBlendFunction = (decltype(grAlphaBlendFunction)) SafeGetProcAddress(glide3xDllHandle, "_grAlphaBlendFunction@16");
    grAlphaCombine = (decltype(grAlphaCombine)) SafeGetProcAddress(glide3xDllHandle, "_grAlphaCombine@20");
    grAlphaControlsITRGBLighting = (decltype(grAlphaControlsITRGBLighting)) SafeGetProcAddress(glide3xDllHandle, "_grAlphaControlsITRGBLighting@4");
    grAlphaTestFunction = (decltype(grAlphaTestFunction)) SafeGetProcAddress(glide3xDllHandle, "_grAlphaTestFunction@4");
    grAlphaTestReferenceValue = (decltype(grAlphaTestReferenceValue)) SafeGetProcAddress(glide3xDllHandle, "_grAlphaTestReferenceValue@4");
    grBufferClear = (decltype(grBufferClear)) SafeGetProcAddress(glide3xDllHandle, "_grBufferClear@12");
    grBufferSwap = (decltype(grBufferSwap)) SafeGetProcAddress(glide3xDllHandle, "_grBufferSwap@4");
    //grCheckForRoom = (decltype(grCheckForRoom)) SafeGetProcAddress(glide3xDllHandle, "_grCheckForRoom@4");
    grChromakeyMode = (decltype(grChromakeyMode)) SafeGetProcAddress(glide3xDllHandle, "_grChromakeyMode@4");
    grChromakeyValue = (decltype(grChromakeyValue)) SafeGetProcAddress(glide3xDllHandle, "_grChromakeyValue@4");
    grClipWindow = (decltype(grClipWindow)) SafeGetProcAddress(glide3xDllHandle, "_grClipWindow@16");
    grColorCombine = (decltype(grColorCombine)) SafeGetProcAddress(glide3xDllHandle, "_grColorCombine@20");
    grColorMask = (decltype(grColorMask)) SafeGetProcAddress(glide3xDllHandle, "_grColorMask@8");
    grConstantColorValue = (decltype(grConstantColorValue)) SafeGetProcAddress(glide3xDllHandle, "_grConstantColorValue@4");
    grCoordinateSpace = (decltype(grCoordinateSpace)) SafeGetProcAddress(glide3xDllHandle, "_grCoordinateSpace@4");
    grCullMode = (decltype(grCullMode)) SafeGetProcAddress(glide3xDllHandle, "_grCullMode@4");
    grDepthBiasLevel = (decltype(grDepthBiasLevel)) SafeGetProcAddress(glide3xDllHandle, "_grDepthBiasLevel@4");
    grDepthBufferFunction = (decltype(grDepthBufferFunction)) SafeGetProcAddress(glide3xDllHandle, "_grDepthBufferFunction@4");
    grDepthBufferMode = (decltype(grDepthBufferMode)) SafeGetProcAddress(glide3xDllHandle, "_grDepthBufferMode@4");
    grDepthMask = (decltype(grDepthMask)) SafeGetProcAddress(glide3xDllHandle, "_grDepthMask@4");
    grDepthRange = (decltype(grDepthRange)) SafeGetProcAddress(glide3xDllHandle, "_grDepthRange@8");
    grDisable = (decltype(grDisable)) SafeGetProcAddress(glide3xDllHandle, "_grDisable@4");
    grDisableAllEffects = (decltype(grDisableAllEffects)) SafeGetProcAddress(glide3xDllHandle, "_grDisableAllEffects@0");
    grDitherMode = (decltype(grDitherMode)) SafeGetProcAddress(glide3xDllHandle, "_grDitherMode@4");
    grDrawLine = (decltype(grDrawLine)) SafeGetProcAddress(glide3xDllHandle, "_grDrawLine@8");
    grDrawPoint = (decltype(grDrawPoint)) SafeGetProcAddress(glide3xDllHandle, "_grDrawPoint@4");
    grDrawTriangle = (decltype(grDrawTriangle)) SafeGetProcAddress(glide3xDllHandle, "_grDrawTriangle@12");
    grDrawVertexArray = (decltype(grDrawVertexArray)) SafeGetProcAddress(glide3xDllHandle, "_grDrawVertexArray@12");
    grDrawVertexArrayContiguous = (decltype(grDrawVertexArrayContiguous)) SafeGetProcAddress(glide3xDllHandle, "_grDrawVertexArrayContiguous@16");
    grEnable = (decltype(grEnable)) SafeGetProcAddress(glide3xDllHandle, "_grEnable@4");
    grErrorSetCallback = (decltype(grErrorSetCallback)) SafeGetProcAddress(glide3xDllHandle, "_grErrorSetCallback@4");
    grFinish = (decltype(grFinish)) SafeGetProcAddress(glide3xDllHandle, "_grFinish@0");
    grFlush = (decltype(grFlush)) SafeGetProcAddress(glide3xDllHandle, "_grFlush@0");
    grFogColorValue = (decltype(grFogColorValue)) SafeGetProcAddress(glide3xDllHandle, "_grFogColorValue@4");
    grFogMode = (decltype(grFogMode)) SafeGetProcAddress(glide3xDllHandle, "_grFogMode@4");
    grFogTable = (decltype(grFogTable)) SafeGetProcAddress(glide3xDllHandle, "_grFogTable@4");

    grGet = (decltype(grGet)) SafeGetProcAddress(glide3xDllHandle, "_grGet@12");
    if(grGet == nullptr) grGet = (decltype(grGet)) SafeGetProcAddress(glide3xDllHandle, "grGet@12");

    grGetProcAddress = (decltype(grGetProcAddress)) SafeGetProcAddress(glide3xDllHandle, "_grGetProcAddress@4");
    grGetString = (decltype(grGetString)) SafeGetProcAddress(glide3xDllHandle, "_grGetString@4");
    grGlideGetState = (decltype(grGlideGetState)) SafeGetProcAddress(glide3xDllHandle, "_grGlideGetState@4");
    grGlideGetVertexLayout = (decltype(grGlideGetVertexLayout)) SafeGetProcAddress(glide3xDllHandle, "_grGlideGetVertexLayout@4");
    grGlideInit = (decltype(grGlideInit)) SafeGetProcAddress(glide3xDllHandle, "_grGlideInit@0");
    grGlideSetState = (decltype(grGlideSetState)) SafeGetProcAddress(glide3xDllHandle, "_grGlideSetState@4");
    grGlideSetVertexLayout = (decltype(grGlideSetVertexLayout)) SafeGetProcAddress(glide3xDllHandle, "_grGlideSetVertexLayout@4");
    grGlideShutdown = (decltype(grGlideShutdown)) SafeGetProcAddress(glide3xDllHandle, "_grGlideShutdown@0");
    grLfbConstantAlpha = (decltype(grLfbConstantAlpha)) SafeGetProcAddress(glide3xDllHandle, "_grLfbConstantAlpha@4");
    grLfbConstantDepth = (decltype(grLfbConstantDepth)) SafeGetProcAddress(glide3xDllHandle, "_grLfbConstantDepth@4");
    grLfbLock = (decltype(grLfbLock)) SafeGetProcAddress(glide3xDllHandle, "_grLfbLock@24");
    grLfbReadRegion = (decltype(grLfbReadRegion)) SafeGetProcAddress(glide3xDllHandle, "_grLfbReadRegion@28");
    grLfbUnlock = (decltype(grLfbUnlock)) SafeGetProcAddress(glide3xDllHandle, "_grLfbUnlock@8");
    grLfbWriteColorFormat = (decltype(grLfbWriteColorFormat)) SafeGetProcAddress(glide3xDllHandle, "_grLfbWriteColorFormat@4");
    grLfbWriteColorSwizzle = (decltype(grLfbWriteColorSwizzle)) SafeGetProcAddress(glide3xDllHandle, "_grLfbWriteColorSwizzle@8");
    grLfbWriteRegion = (decltype(grLfbWriteRegion)) SafeGetProcAddress(glide3xDllHandle, "_grLfbWriteRegion@36");
    grLoadGammaTable = (decltype(grLoadGammaTable)) SafeGetProcAddress(glide3xDllHandle, "_grLoadGammaTable@16");
    grQueryResolutions = (decltype(grQueryResolutions)) SafeGetProcAddress(glide3xDllHandle, "_grQueryResolutions@8");
    grRenderBuffer = (decltype(grRenderBuffer)) SafeGetProcAddress(glide3xDllHandle, "_grRenderBuffer@4");
    grReset = (decltype(grReset)) SafeGetProcAddress(glide3xDllHandle, "_grReset@4");
    grSelectContext = (decltype(grSelectContext)) SafeGetProcAddress(glide3xDllHandle, "_grSelectContext@4");
    grSetNumPendingBuffers = (decltype(grSetNumPendingBuffers)) SafeGetProcAddress(glide3xDllHandle, "_grSetNumPendingBuffers@4");
    grSplash = (decltype(grSplash)) SafeGetProcAddress(glide3xDllHandle, "_grSplash@20");
    //grSstConfigPipeline = (decltype(grSstConfigPipeline)) SafeGetProcAddress(glide3xDllHandle, "_grSstConfigPipeline@12");
    grSstOrigin = (decltype(grSstOrigin)) SafeGetProcAddress(glide3xDllHandle, "_grSstOrigin@4");
    grSstSelect = (decltype(grSstSelect)) SafeGetProcAddress(glide3xDllHandle, "_grSstSelect@4");
    //grSstVidMode = (decltype(grSstVidMode)) SafeGetProcAddress(glide3xDllHandle, "_grSstVidMode@8");
    grSstWinClose = (decltype(grSstWinClose)) SafeGetProcAddress(glide3xDllHandle, "_grSstWinClose@4");
    grSstWinOpen = (decltype(grSstWinOpen)) SafeGetProcAddress(glide3xDllHandle, "_grSstWinOpen@28");
    grStippleMode = (decltype(grStippleMode)) SafeGetProcAddress(glide3xDllHandle, "_grStippleMode@4");
    grStipplePattern = (decltype(grStipplePattern)) SafeGetProcAddress(glide3xDllHandle, "_grStipplePattern@4");
    grTexCalcMemRequired = (decltype(grTexCalcMemRequired)) SafeGetProcAddress(glide3xDllHandle, "_grTexCalcMemRequired@16");
    grTexClampMode = (decltype(grTexClampMode)) SafeGetProcAddress(glide3xDllHandle, "_grTexClampMode@12");
    grTexCombine = (decltype(grTexCombine)) SafeGetProcAddress(glide3xDllHandle, "_grTexCombine@28");
    grTexDetailControl = (decltype(grTexDetailControl)) SafeGetProcAddress(glide3xDllHandle, "_grTexDetailControl@16");
    grTexDownloadMipMap = (decltype(grTexDownloadMipMap)) SafeGetProcAddress(glide3xDllHandle, "_grTexDownloadMipMap@16");
    grTexDownloadMipMapLevel = (decltype(grTexDownloadMipMapLevel)) SafeGetProcAddress(glide3xDllHandle, "_grTexDownloadMipMapLevel@32");
    grTexDownloadMipMapLevelPartial = (decltype(grTexDownloadMipMapLevelPartial)) SafeGetProcAddress(glide3xDllHandle, "_grTexDownloadMipMapLevelPartial@40");
    grTexDownloadTable = (decltype(grTexDownloadTable)) SafeGetProcAddress(glide3xDllHandle, "_grTexDownloadTable@8");
    grTexDownloadTablePartial = (decltype(grTexDownloadTablePartial)) SafeGetProcAddress(glide3xDllHandle, "_grTexDownloadTablePartial@16");
    grTexFilterMode = (decltype(grTexFilterMode)) SafeGetProcAddress(glide3xDllHandle, "_grTexFilterMode@12");
    grTexLodBiasValue = (decltype(grTexLodBiasValue)) SafeGetProcAddress(glide3xDllHandle, "_grTexLodBiasValue@8");
    grTexMaxAddress = (decltype(grTexMaxAddress)) SafeGetProcAddress(glide3xDllHandle, "_grTexMaxAddress@4");
    grTexMinAddress = (decltype(grTexMinAddress)) SafeGetProcAddress(glide3xDllHandle, "_grTexMinAddress@4");
    grTexMipMapMode = (decltype(grTexMipMapMode)) SafeGetProcAddress(glide3xDllHandle, "_grTexMipMapMode@12");
    grTexMultibase = (decltype(grTexMultibase)) SafeGetProcAddress(glide3xDllHandle, "_grTexMultibase@8");
    grTexMultibaseAddress = (decltype(grTexMultibaseAddress)) SafeGetProcAddress(glide3xDllHandle, "_grTexMultibaseAddress@20");
    grTexNCCTable = (decltype(grTexNCCTable)) SafeGetProcAddress(glide3xDllHandle, "_grTexNCCTable@4");
    grTexSource = (decltype(grTexSource)) SafeGetProcAddress(glide3xDllHandle, "_grTexSource@16");
    grTexTextureMemRequired = (decltype(grTexTextureMemRequired)) SafeGetProcAddress(glide3xDllHandle, "_grTexTextureMemRequired@8");
    grVertexLayout = (decltype(grVertexLayout)) SafeGetProcAddress(glide3xDllHandle, "_grVertexLayout@12");
    grViewport = (decltype(grViewport)) SafeGetProcAddress(glide3xDllHandle, "_grViewport@16");
    gu3dfGetInfo = (decltype(gu3dfGetInfo)) SafeGetProcAddress(glide3xDllHandle, "_gu3dfGetInfo@8");
    gu3dfLoad = (decltype(gu3dfLoad)) SafeGetProcAddress(glide3xDllHandle, "_gu3dfLoad@8");
    //guEncodeRLE16 = (decltype(guEncodeRLE16)) SafeGetProcAddress(glide3xDllHandle, "_guEncodeRLE16@16");
    guFogGenerateExp2 = (decltype(guFogGenerateExp2)) SafeGetProcAddress(glide3xDllHandle, "_guFogGenerateExp2@8");
    guFogGenerateExp = (decltype(guFogGenerateExp)) SafeGetProcAddress(glide3xDllHandle, "_guFogGenerateExp@8");
    guFogGenerateLinear = (decltype(guFogGenerateLinear)) SafeGetProcAddress(glide3xDllHandle, "_guFogGenerateLinear@12");
    guFogTableIndexToW = (decltype(guFogTableIndexToW)) SafeGetProcAddress(glide3xDllHandle, "_guFogTableIndexToW@4");
    guGammaCorrectionRGB = (decltype(guGammaCorrectionRGB)) SafeGetProcAddress(glide3xDllHandle, "_guGammaCorrectionRGB@12");
}
